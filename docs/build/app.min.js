function EditPopover(e,t,n){var o=this;o.containerEl=e,o.scope=t,o.node=n,o.$el=void 0,o.$name=void 0,o.$body=void 0,o.width=void 0,o.height=void 0,o.halfwidth=void 0,o.halfheight=void 0,o.hidden=!1,o.makeElement(),o.addEventListeners()}function ForceGraph(e,t){var n=this;n.scope=t,n.containerEl=e;var o=n.containerEl.getBoundingClientRect();n.width=o.width,n.height=o.height,n.mousePosition={},n.keysPressed={},n.justZoomed=!1,n.isDragging=!1,n.isLinking=!1,n.linkingCursor=null,n.linkingSource=null,n.nodes=[],n.links=[],n.svg,n.defs,n.rect,n.group,n.node,n.underlink,n.link,n.tick=n.makeTick(),n.force=n.makeForce(),n.zoom=n.makeZoom(),n.drag=n.makeDrag(),n.nodeClick=n.makeNodeClick(),n.nodeMouseover=n.makeNodeMouseover(),n.nodeMouseout=n.makeNodeMouseout(),n.linkMouseover=n.makeLinkMouseover(),n.linkMouseout=n.makeLinkMouseout(),n.nodePopoversById={},n.linkPopoversById={},n.editPopoversById={},n.init(),d3.select(window).on("resize",function(){n.updateSize()}).on("keydown",function(){n.keysPressed[d3.event.keyCode]=!0,n.keysPressed[27]&&n.isLinking&&n.stopLinkingState()}).on("keyup",function(){n.keysPressed[d3.event.keyCode]=!1}).on("mousemove",function(){var e=n.zoom.scale(),t=n.zoom.translate(),o=(d3.event.x-t[0])/e,i=(d3.event.y-t[1])/e;n.mousePosition.x=o,n.mousePosition.y=i,n.isLinking&&(n.linkingCursor.px=o,n.linkingCursor.py=i,n.linkingCursor.x=o,n.linkingCursor.y=i,n.tick(),n.force.start())}).on("click",function(){return n.justZoomed?void(n.justZoomed=!1):void(n.isLinking&&n.stopLinkingState())})}function HomeGraph(e){this.containerEl=e,this.width=e.clientWidth,this.height=e.clientHeight,this.svg,this.group,this.node,this.link,this.isDragging=!1,this.tick=this.makeTick(),this.force=this.makeForce(),this.zoom=this.makeZoom(),this.drag=this.makeDrag(),this.init();var t=this;d3.select(window).on("resize",function(){t.updateSize()})}function LinkPopover(e,t,n,o){var i=this;i.containerEl=e,i.scope=t,i.link=n,i.linkSelect=o,i.linkbackSelect=void 0,i.$el=void 0,i.width=void 0,i.height=void 0,i.halfwidth=void 0,i.halfheight=void 0,i.hidden=!1,i.hovered=!1,i.makeElement(),i.addEventListeners()}function NodePopover(e,t,n,o){var i=this;i.containerEl=e,i.scope=t,i.node=n,i.nodeSelect=o,i.$el=void 0,i.width=void 0,i.height=void 0,i.halfwidth=void 0,i.halfheight=void 0,i.hidden=!1,i.hovered=!1,i.makeElement(),i.addEventListeners()}function NoteNodePopover(e,t,n,o){var i=this;i.containerEl=e,i.scope=t,i.node=n,i.nodeSelect=o,i.$el=void 0,i.width=void 0,i.height=void 0,i.halfwidth=void 0,i.halfheight=void 0,i.hidden=!1,i.hovered=!1,i.makeElement(),i.addEventListeners()}EditPopover.prototype.makeElement=function(){var e=this;e.$el=$('<div class="graph-popover edit popover right"><div class="arrow"></div><div class="popover-content"><div class="upper"><div class="name"><input type="text" class="form-control input-sm" placeholder="Add title..."></div><div class="controls"><div class="btn-group" role="group" aria-label="Editor controls"><button type="button" class="cancel-button btn btn-danger btn-xs"><i class="fa fa-fw fa-close"></i></button><button type="button" class="confirm-button btn btn-success btn-xs"><i class="fa fa-fw fa-check"></i></button></div></div></div><div class="lower"><textarea rows="5" class="form-control input-sm" placeholder="Add caption..."></textarea></div></div></div>'),$(e.containerEl).append(e.$el),e.$name=e.$el.find("input"),e.$body=e.$el.find("textarea"),e.width=e.$el.outerWidth(),e.height=e.$el.outerHeight(),e.halfwidth=e.width/2,e.halfheight=e.height/2,e.hide()},EditPopover.prototype.addEventListeners=function(){var e=this;e.$el.find(".cancel-button").on("click",function(){e.hide()}),e.$el.find(".confirm-button").on("click",function(){e.save(),e.hide()}),e.$name.on("keypress",function(t){switch(t.which){case 13:e.save(),e.hide()}})},EditPopover.prototype.load=function(){var e=this;e.$name.val(e.node.name||""),e.$body.val(e.node.body||"")},EditPopover.prototype.save=function(){var e=this,t=e.$name.val()||"",n=e.$body.val()||"";e.scope.$apply(function(){e.scope.session.updateNoteNodeContent(e.node.uuid,t,n)})},EditPopover.prototype.show=function(){var e=this;setTimeout(function(){e.hidden&&(e.hidden=!1,e.load(),e.$el.show())},1)},EditPopover.prototype.hide=function(){var e=this;setTimeout(function(){e.hidden||(e.hidden=!0,e.$el.hide())},1)},EditPopover.prototype.toggle=function(){var e=this;e.hidden?e.show():e.hide()},EditPopover.prototype.position=function(e,t){var n=this;n.$el.css({top:t-22,left:e-2})},ForceGraph.prototype.init=function(){var e=this;e.svg=d3.select(e.containerEl).append("svg").attr("width",e.width).attr("height",e.height),e.defs=e.svg.append("svg:defs"),e.rect=e.svg.append("svg:rect").attr("width","100%").attr("height","100%").style("fill","none").style("pointer-events","all").call(e.zoom).on("dblclick.zoom",null),e.group=e.svg.append("svg:g"),e.underlink=e.group.append("svg:g").attr("class","underlinks").selectAll("line.underlink"),e.link=e.group.append("svg:g").attr("class","links").selectAll("line.link"),e.node=e.group.append("svg:g").attr("class","nodes").selectAll("g.node"),e.defs.selectAll("marker").data(["link-arrow","link-arrow-hover","link-arrow-note","link-arrow-note-hover"]).enter().append("svg:marker").attr("id",function(e){return e}).attr("viewBox","0 -5 10 10").attr("refX",21).attr("refY",0).attr("markerWidth",4).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M0,-5 L10,0 L0,5"),e.defs.selectAll("marker").append("svg:marker").attr("id","link-arrow-note-linking").attr("viewBox","0 -5 10 10").attr("refX",7).attr("refY",0).attr("markerWidth",4).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M0,-5 L10,0 L0,5")},ForceGraph.prototype.getViewCenter=function(){var e=this,t=e.zoom.scale(),n=e.zoom.translate(),o=n[0]/t,i=n[1]/t,r=e.width/t,a=e.height/t,s=r/2-o,d=a/2-i;return[s,d]},ForceGraph.prototype.updateSize=function(){var e=this,t=e.containerEl.getBoundingClientRect();return e.width=t.width,e.height=t.height,e.width&&e.height?(e.svg.attr("width",e.width).attr("height",e.height),void e.force.size([e.width,e.height]).start()):void console.error("graph size updating with no container size")},ForceGraph.prototype.updateCurrentNode=function(e){var t=this;t.node.each(function(t){e&&e.uuid&&t.uuid===e.uuid?d3.select(this).classed("active",!0):d3.select(this).classed("active",!1)})},ForceGraph.prototype.updateNoteNodeContent=function(e){var t=this,n=t.node.filter(function(t){return t.uuid===e.uuid});n.selectAll("*").remove(),t.addNoteNode(e,n)},ForceGraph.prototype.updateNodesAndLinks=function(e,t){var n=this;if(!n.width||!n.height)return void console.error("graph size updating with no container size");if(n.nodes=e.slice(),n.links=t.slice(),n.isLinking){var o={uuid:"linking-cursor-node",type:"cursor",x:n.mousePosition.x||void 0,y:n.mousePosition.y||void 0,px:n.mousePosition.x||void 0,py:n.mousePosition.y||void 0,fixed:!0},i={source:n.linkingSource,target:o,linking:!0};e.push(o),t.push(i),n.linkingCursor=o}var r=n.getViewCenter(),a=r[0],s=r[1];e.forEach(function(e){e.x||e.y||(e.x=a+5*Math.random(),e.y=s+5*Math.random())}),n.force.nodes(e),n.force.links(t),n.underlink=n.underlink.data(t,function(e){return e.uuid}),n.underlink.exit().remove(),n.underlink.enter().append("svg:line").attr("class","underlink").classed("linkback",function(e){return e.linkbackId}).classed("linking",function(e){return e.linking}).classed("note",function(e){return"note"===e.source.type}).on("mouseover",n.linkMouseover).on("mouseout",n.linkMouseout),n.link=n.link.data(t,function(e){return e.uuid});var d=n.link.exit();d.each(function(e){n.linkPopoversById[e.uuid]&&(n.linkPopoversById[e.uuid].$el.remove(),delete n.linkPopoversById[e.uuid])}),d.remove();var c=n.link.enter().append("svg:line").attr("class","link").classed("linkback",function(e){return e.linkbackId}).classed("linking",function(e){return e.linking}).classed("note",function(e){return"note"===e.source.type});c.each(function(e){if(e.linkbackId){var t=n.linkPopoversById[e.linkbackId];if(!t)return;t.addLinkback(d3.select(this))}else n.linkPopoversById[e.uuid]=new LinkPopover(n.containerEl,n.scope,e,d3.select(this))}),n.node=n.node.data(e,function(e){return e.uuid});var u=n.node.exit();u.each(function(e){n.nodePopoversById[e.uuid]&&(n.nodePopoversById[e.uuid].$el.remove(),delete n.nodePopoversById[e.uuid]),n.editPopoversById[e.uuid]&&(n.editPopoversById[e.uuid].$el.remove(),delete n.editPopoversById[e.uuid])}),u.remove();var l=n.node.enter().append("svg:g").attr("class","node").classed("fixed",function(e){return e.fixed}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"});l.each(function(e){var t=d3.select(this);switch(e.type){case"article":case"category":case"search":n.addNode(e,t);break;case"note":n.addNoteNode(e,t);break;case"cursor":n.addCursorNode(e,t)}}),n.force.start()},ForceGraph.prototype.addNode=function(e,t){var n=this;t.append("svg:circle").attr("r",16).attr("class","disc").on("mouseover",n.nodeMouseover).on("mouseout",n.nodeMouseout).on("click",n.nodeClick).call(n.drag),t.append("svg:circle").attr("r",3).attr("class","pin"),t.append("svg:text").attr("class","name").attr("dx",6).attr("dy",-6).text(function(e){return e.name}).on("click",n.nodeClick).call(n.drag),n.nodePopoversById[e.uuid]=new NodePopover(n.containerEl,n.scope,e,t)},ForceGraph.prototype.addNoteNode=function(e,t){var n=this;t.append("svg:text").attr("class","note-icon note-icon-back").attr("dx",0).attr("dy",-1).attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-family","FontAwesome").text(""),t.append("svg:text").attr("class","note-icon note-icon-fore").attr("dx",0).attr("dy",-1).attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-family","FontAwesome").text("").on("mouseover",n.nodeMouseover).on("mouseout",n.nodeMouseout).on("click",n.nodeClick).call(n.drag),t.append("svg:circle").attr("r",3).attr("class","pin"),t.append("svg:text").attr("class","note").attr("dx",18).attr("dy",4).text(function(e){return e.name}).on("click",n.nodeClick).call(n.drag),t.append("foreignObject").attr("width",240).attr("height",120).attr("x",18).attr("y",function(e){return e.name&&e.name.length?8:-8}).style("overflow","visible").on("click",n.nodeClick).call(n.drag).append("xhtml:body").html(function(e){return e.body?e.body.replace(/\n/g,"<br>"):""}).each(function(e){var t=this.parentNode;t.setAttribute("width",this.clientWidth),t.setAttribute("height",this.clientHeight)}),n.nodePopoversById[e.uuid]=new NoteNodePopover(n.containerEl,n.scope,e,t),n.editPopoversById[e.uuid]=new EditPopover(n.containerEl,n.scope,e)},ForceGraph.prototype.addCursorNode=function(e,t){t.append("svg:circle").attr("r",1).attr("class","cursor")},ForceGraph.prototype.updatePopovers=function(){var e=this,t=e.zoom.scale(),n=e.zoom.translate(),o=n[0],i=n[1];Object.keys(e.nodePopoversById).forEach(function(n){var r=e.nodePopoversById[n];if(!r.hidden){var a=r.node.x*t+o,s=r.node.y*t+i;s+=14*t,r.position(a,s)}}),Object.keys(e.editPopoversById).forEach(function(n){var r=e.editPopoversById[n];if(!r.hidden){var a=r.node.x*t+o,s=r.node.y*t+i;a+=10*t,r.position(a,s)}}),Object.keys(e.linkPopoversById).forEach(function(n){var r=e.linkPopoversById[n];if(!r.hidden){var a=r.link.source,s=r.link.target,d=a.x*t+o,c=a.y*t+i,u=s.x*t+o,l=s.y*t+i,h=(d+u)/2,p=(c+l)/2;r.position(h,p)}})},ForceGraph.prototype.updateNodePopover=function(e){var t=this,n=t.zoom.scale(),o=t.zoom.translate(),i=o[0],r=o[1],a=e.node.x*n+i,s=e.node.y*n+r;s+=14*n,e.position(a,s)},ForceGraph.prototype.updateEditPopover=function(e){var t=this,n=t.zoom.scale(),o=t.zoom.translate(),i=o[0],r=o[1],a=e.node.x*n+i,s=e.node.y*n+r;a+=10*n,e.position(a,s)},ForceGraph.prototype.updateLinkPopover=function(e){var t=this,n=t.zoom.scale(),o=t.zoom.translate(),i=o[0],r=o[1],a=e.link.source,s=e.link.target,d=a.x*n+i,c=a.y*n+r,u=s.x*n+i,l=s.y*n+r,h=(d+u)/2,p=(c+l)/2;e.position(h,p)},ForceGraph.prototype.hideAllPopovers=function(e){var t=this;Object.keys(t.nodePopoversById).forEach(function(n){if(n!=e){var o=t.nodePopoversById[n];o.hidden||o.hide(!0)}}),Object.keys(t.linkPopoversById).forEach(function(n){if(n!=e){var o=t.linkPopoversById[n];o.hidden||o.hide(!0)}})},ForceGraph.prototype.makeTick=function(){function e(e){return e.source.x}function t(e){return e.source.y}function n(e){return e.target.x}function o(e){return e.target.y}function i(e){return"translate("+e.x+","+e.y+")"}var r=this;return function(){r.underlink.attr("x1",e).attr("y1",t).attr("x2",n).attr("y2",o),r.link.attr("x1",e).attr("y1",t).attr("x2",n).attr("y2",o),r.node.attr("transform",i),r.updatePopovers()}},ForceGraph.prototype.makeForce=function(){return d3.layout.force().size([this.width,this.height]).linkDistance(100).linkDistance(function(e){switch(e.source.type){case"article":case"category":case"search":return 100;case"note":case"cursor":return 1}}).linkStrength(function(e){switch(e.source.type){case"article":case"category":case"search":return.2;case"note":case"cursor":return.07}}).charge(function(e){switch(e.type){case"article":case"category":case"search":return-400;case"note":return-800;case"cursor":return 0}}).gravity(.03).friction(.8).theta(.9).alpha(.1).on("tick",this.tick)},ForceGraph.prototype.makeZoom=function(){var e=this;return d3.behavior.zoom().scaleExtent([.2,10]).on("zoom",function(){e.group.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),e.updatePopovers(),e.justZoomed=!0})},ForceGraph.prototype.makeDrag=function(){var e=this;return d3.behavior.drag().on("dragstart",function(t,n){e.isLinking||d3.event.sourceEvent.stopPropagation()}).on("drag",function(t,n){e.isLinking||(e.isDragging||(e.isDragging=!0,e.nodePopoversById[t.uuid].$el.hide(),e.keysPressed[16]||(d3.select(this.parentNode).classed("fixed",!0),t.fixed=!0)),e.force.start(),d3.event.sourceEvent.stopPropagation(),t.px+=d3.event.x,t.py+=d3.event.y,t.x+=d3.event.x,t.y+=d3.event.y,e.tick())}).on("dragend",function(t,n){if(!e.isLinking&&(d3.event.sourceEvent.stopPropagation(),e.isDragging)){e.tick();var o=e.nodePopoversById[t.uuid];e.updateNodePopover(o),o.$el.show(),setTimeout(function(){e.isDragging=!1,o.show()},50)}})},ForceGraph.prototype.makeNodeClick=function(){var e=this;return function(t){if(d3.event.preventDefault(),d3.event.stopPropagation(),!e.isDragging)if(e.isLinking)t.uuid===e.linkingSource.uuid?e.stopLinkingState():e.scope.$apply(function(){e.scope.addLink(e.linkingSource.uuid,t.uuid)});else if(d3.event.shiftKey)e.toggleNodePin(t,d3.select(this.parentNode));else if("note"===t.type){var n=e.editPopoversById[t.uuid],o=e.nodePopoversById[t.uuid];n.hidden?(e.updateEditPopover(n),n.show(),o.hide(!0)):(n.hide(),o.show())}else e.scope.$apply(function(){e.scope.setCurrentNode(t.uuid)})}},ForceGraph.prototype.makeNodeMouseover=function(){var e=this;return function(t){if(!e.isDragging&&!e.isLinking){t.hovered=!0;var n=e.nodePopoversById[t.uuid];e.updateNodePopover(n),e.hideAllPopovers(t.uuid),n.show()}}},ForceGraph.prototype.makeNodeMouseout=function(){var e=this;return function(t){if(!e.isDragging&&!e.isLinking){t.hovered=!1;var n=e.nodePopoversById[t.uuid];n.hide()}}},ForceGraph.prototype.makeLinkMouseover=function(){var e=this;return function(t){if(!e.isDragging&&!e.isLinking){t.hovered=!0,d3.select(this).classed("hovered",!0);var n=e.linkPopoversById[t.uuid];e.updateLinkPopover(n),e.hideAllPopovers(t.uuid),n.show()}}},ForceGraph.prototype.makeLinkMouseout=function(){var e=this;return function(t){if(!e.isDragging&&!e.isLinking){t.hovered=!1,d3.select(this).classed("hovered",!1);var n=e.linkPopoversById[t.uuid];n.hide()}}},ForceGraph.prototype.toggleNodePin=function(e,t){var n=this;t||(t=n.node.filter(function(t){return t.uuid===e.uuid})),e.fixed=!e.fixed,t.classed("fixed",e.fixed),n.force.start()},ForceGraph.prototype.centerOnNode=function(e){var t=this;if(e){var n=t.zoom.scale(),o=t.width,i=t.height,r=e.x*n,a=e.y*n,s=o/2-r,d=i/2-a;t.zoom.translate([s,d]),t.zoom.event(t.rect.transition().duration(600))}},ForceGraph.prototype.startLinkingState=function(e){var t=this;t.isLinking=!0,t.linkingSource=e,t.updateNodesAndLinks(t.nodes,t.links)},ForceGraph.prototype.stopLinkingState=function(){var e=this;e.isLinking=!1,e.linkingSource=null,e.linkingCursor=null,e.updateNodesAndLinks(e.nodes,e.links)},HomeGraph.prototype.init=function(){this.svg=d3.select(this.containerEl).append("svg").attr("width",this.width).attr("height",this.height);this.svg.append("rect").attr("width","100%").attr("height","100%").style("fill","none").style("pointer-events","all").call(this.zoom).on("dblclick.zoom",null);this.group=this.svg.append("g"),this.link=this.group.append("svg:g").attr("class","links").selectAll("line.link"),this.node=this.group.append("svg:g").attr("class","nodes").selectAll("g.node")},HomeGraph.prototype.updateSize=function(){this.width=this.containerEl.clientWidth,this.height=this.containerEl.clientHeight,this.svg.attr("width",this.width).attr("height",this.height),this.force.size([this.width,this.height]).resume()},HomeGraph.prototype.updateNodesAndLinks=function(e,t){e=e.slice(),t=t.slice(),this.force.nodes(e),this.force.links(t),this.link=this.link.data(t),this.link.exit().remove();this.link.enter().append("svg:line").attr("class","link");this.node=this.node.data(e),this.node.exit().remove();var n=this.node.enter().append("svg:g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});n.append("svg:circle").attr("r",18).attr("class","disc").call(this.drag),this.force.start()},HomeGraph.prototype.makeTick=function(){var e=this;return function(){e.link.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),e.node.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}},HomeGraph.prototype.makeForce=function(){return d3.layout.force().size([this.width,this.height]).linkDistance(60).charge(-1200).gravity(.2).friction(.4).theta(.01).on("tick",this.tick)},HomeGraph.prototype.makeZoom=function(){var e=this;return d3.behavior.zoom().scaleExtent([.2,10]).on("zoom",function(){e.group.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")})},HomeGraph.prototype.makeDrag=function(){var e=this;return d3.behavior.drag().on("dragstart",function(e,t){d3.event.sourceEvent.stopPropagation()}).on("drag",function(t,n){e.isDragging||(e.isDragging=!0),e.force.start(),d3.event.sourceEvent.stopPropagation(),t.px+=d3.event.x,t.py+=d3.event.y,t.x+=d3.event.x,t.y+=d3.event.y,e.tick()}).on("dragend",function(t,n){d3.event.sourceEvent.stopPropagation(),e.isDragging&&(e.tick(),e.isDragging=!1)})},LinkPopover.prototype.makeElement=function(){var e=this;e.$el=$('<div class="graph-popover link popover"><div class="popover-content"><div class="btn-group" role="group" aria-label="Link controls"><button type="button" class="del-button btn btn-default btn-xs"><i class="fa fa-fw fa-unlink"></i></button></div></div></div>'),$(e.containerEl).append(e.$el),e.width=e.$el.outerWidth(),e.height=e.$el.outerHeight(),e.halfwidth=e.width/2,e.halfheight=e.height/2,e.hide()},LinkPopover.prototype.addEventListeners=function(){var e=this;e.$el.on("mouseover",function(){e.hovered=!0}),e.$el.on("mouseout",function(){e.hovered=!1,setTimeout(function(){e.link.hovered||e.hide()},1)}),e.$el.find(".del-button").on("click",function(){e.scope.removeLink(e.link.uuid)})},LinkPopover.prototype.addLinkback=function(e){var t=this;t.linkbackSelect=e},LinkPopover.prototype.show=function(){var e=this;setTimeout(function(){e.hidden&&(e.hidden=!1,e.$el.show(),e.linkSelect.classed("hovered",!0),e.linkbackSelect&&e.linkbackSelect.classed("hovered",!0))},1)},LinkPopover.prototype.hide=function(e){var t=this;return e?void t._hide():void setTimeout(function(){t.hovered||t.hidden||t._hide()},1)},LinkPopover.prototype._hide=function(){var e=this;e.hidden=!0,e.$el.hide(),e.linkSelect.classed("hovered",!1),e.linkbackSelect&&e.linkbackSelect.classed("hovered",!1)},LinkPopover.prototype.position=function(e,t){var n=this;n.$el.css({top:t-n.halfheight,left:e-n.halfwidth})},NodePopover.prototype.makeElement=function(){var e=this;e.$el=$('<div class="graph-popover node popover bottom"><div class="arrow"></div><div class="popover-content"><div class="btn-group" role="group" aria-label="Node controls"><button type="button" class="pin-button btn btn-default btn-xs"><i class="fa fa-fw fa-thumb-tack"></i></button><button type="button" class="del-button btn btn-default btn-xs"><i class="fa fa-fw fa-trash-o"></i></button></div></div></div>'),$(e.containerEl).append(e.$el),e.width=e.$el.outerWidth(),e.height=e.$el.outerHeight(),e.halfwidth=e.width/2,e.halfheight=e.height/2,e.hide()},NodePopover.prototype.addEventListeners=function(){var e=this;e.$el.on("mouseenter",function(){e.hovered=!0}),e.$el.on("mouseleave",function(){e.hovered=!1,setTimeout(function(){e.hide()},50)}),e.$el.find(".pin-button").on("click",function(){e.scope.graph.toggleNodePin(e.node),e.hide(!0)}),e.$el.find(".del-button").on("click",function(){e.scope.removeNode(e.node.uuid)})},NodePopover.prototype.show=function(){var e=this;setTimeout(function(){e.hidden&&(e.hidden=!1,e.$el.show(),e.nodeSelect.classed("hovered",!0))},1)},NodePopover.prototype.hide=function(e){var t=this;return e?void t._hide():void setTimeout(function(){t.hidden||t.hovered||t.node.hovered||t._hide()},100)},NodePopover.prototype._hide=function(){var e=this;e.hidden=!0,e.hovered=!1,e.$el.hide(),e.nodeSelect.classed("hovered",!1)},NodePopover.prototype.position=function(e,t){var n=this;n.$el.css({top:t-n.halfheight+18,left:e-n.halfwidth})},NoteNodePopover.prototype.makeElement=function(){var e=this;e.$el=$('<div class="graph-popover note popover bottom"><div class="arrow"></div><div class="popover-content"><div class="btn-group" role="group" aria-label="Node controls"><button type="button" class="link-button btn btn-default btn-xs"><i class="fa fa-fw fa-link"></i></button><button type="button" class="pin-button btn btn-default btn-xs"><i class="fa fa-fw fa-thumb-tack"></i></button><button type="button" class="del-button btn btn-default btn-xs"><i class="fa fa-fw fa-trash-o"></i></button></div></div></div>'),$(e.containerEl).append(e.$el),e.width=e.$el.outerWidth(),e.height=e.$el.outerHeight(),e.halfwidth=e.width/2,e.halfheight=e.height/2,e.hide()},NoteNodePopover.prototype.addEventListeners=function(){var e=this;e.$el.on("mouseenter",function(){e.hovered=!0}),e.$el.on("mouseleave",function(){e.hovered=!1,setTimeout(function(){e.hide()},50)}),e.$el.find(".pin-button").on("click",function(t){t.preventDefault(),t.stopPropagation(),e.scope.graph.toggleNodePin(e.node),e.hide(!0)}),e.$el.find(".link-button").on("click",function(t){t.preventDefault(),t.stopPropagation(),e.scope.graph.startLinkingState(e.node,e.nodeSelect),e.hide(!0)}),e.$el.find(".del-button").on("click",function(t){t.preventDefault(),t.stopPropagation(),e.scope.removeNode(e.node.uuid)})},NoteNodePopover.prototype.show=function(){var e=this;setTimeout(function(){e.hidden&&(e.hidden=!1,e.$el.show(),e.nodeSelect.classed("hovered",!0))},1)},NoteNodePopover.prototype.hide=function(e){var t=this;return e?void t._hide():void setTimeout(function(){t.hidden||t.hovered||t.node.hovered||t._hide()},100)},NoteNodePopover.prototype._hide=function(){var e=this;e.hidden=!0,e.hovered=!1,e.$el.hide(),e.nodeSelect.classed("hovered",!1)},NoteNodePopover.prototype.position=function(e,t){var n=this;n.$el.css({top:t-n.halfheight+16,left:e-n.halfwidth})},function(){angular.module("wikitree",["ngRoute","LocalStorageModule","ui.bootstrap.alert","wikitree.home","wikitree.session","wikitree.search"]).config(["localStorageServiceProvider",function(e){e.setPrefix("Wikitree")}])}(),function(){angular.module("wikitree").config(["$routeProvider",function(e){e.when("/",{templateUrl:"js/angular/home/home.template.html",controller:"home_controller",resolve:{is_new:["Sessions",function(e){return e.is_new()}]}}).when("/welcome",{templateUrl:"js/angular/home/home.template.html",controller:"home_controller"}).when("/session/:uuid",{templateUrl:"js/angular/session/session.template.html",controller:"session_controller",controllerAs:"session",resolve:{init_session:["Sessions","$route",function(e,t){return e.restore(t.current.params.uuid)}]}}).when("/new/:term/:search?",{templateUrl:"js/angular/session/session.template.html",controller:"session_controller",controllerAs:"session",resolve:{init_session:["Sessions","$route",function(e,t){return e["new"](t.current.params.term)}]}}).otherwise({redirectTo:"/"})}])}(),function(){angular.module("wikitree").factory("Search",["$http","Articles","Categories","Searches",function(e,t,n,o){var i={};return i.get_suggestions=function(t){return e.jsonp("https://en.wikipedia.org/w/api.php",{params:{action:"opensearch",search:t,callback:"JSON_CALLBACK"}}).then(function(e){return e.data[1]})},i.findOrAddArticle=function(e){return e.match(/^Category:/)?i.findOrAddCategory(e):t.getByUnsafeTitle(e).then(function(e){return{type:"article",name:e.title,title:e.title}})["catch"](function(t){return t&&console.error("findOrAddArticle",t),i.findOrAddSearch(e)})},i.findOrAddCategory=function(e){return n.getByUnsafeTitle(e).then(function(e){return{type:"category",name:e.title,title:e.title}})["catch"](function(t){return t&&console.error("findOrAddCategory",t),findOrAddSearch(e)})},i.findOrAddSearch=function(e){return o.getByQuery(e).then(function(t){return{type:"search",name:'Search "'+e+'"',query:e}})["catch"](function(e){return e&&console.error("findOrAddSearch",e),null})},i}])}(),function(){angular.module("wikitree").factory("Sessions",["$rootScope","$location","$route","localStorageService","Utilities",function(e,t,n,o,i){function r(e,t){this["new"]=!0,this.term=e,this.search=t,this.uuid=i.makeUUID(),this.data={current_node_id:void 0,prev_stack:[],next_stack:[],nodes:[],links:[]}}function a(e,t){this.uuid=e.uuid,this.name=t,this.rename=t,this.date=Date.now()}var s={};if(s.index=o.get("index")||[],s.active=o.get("active")||0,s.index.length>0){var d=o.get(s.index[0].uuid);d&&!d.hasOwnProperty("search")&&(o.clearAll(),s.index=o.get("index")||[],s.active=o.get("active")||0)}return e.$on("session:sort",function(e,t){t.start==s.active?s.active=t.stop:t.start>s.active&&t.stop<=s.active?s.active++:t.start<s.active&&t.stop>=s.active&&s.active--}),s.is_new=function(){if(0!==s.index.length){var e=s.index[s.active];e&&t.path("/session/"+e.uuid)}else t.path("/welcome")},s["new"]=function(e){s.active=0;var i="true"===n.current.params.search,d=new r(e,i);return s.index.unshift(new a(d,e)),o.set(d.uuid,d),o.set("index",s.index),o.set("active",s.active),t.path("/session/"+d.uuid).replace(),d},s.save=function(e,t){var n=o.get(e);n&&(n["new"]=!1,n.data=t,s.index[s.active].date=Date.now(),o.set("index",s.index),o.set(e,n))},s.restore=function(e){var n=o.get(e);return n||t.path("/"),s.active=s.index.indexOf(s.index.filter(function(t){return t.uuid===e})[0]),n},s["delete"]=function(e){var n=s.index[e].uuid;if(o.remove(n),s.index.splice(e,1),o.set("index",s.index),0==s.index.length)t.path("/");else if(e==s.active){var i;i=e==s.index.length?s.index[e-1].uuid:s.index[e].uuid,t.path("/session/"+i)}else e<s.active&&s.active--},s}])}(),function(){angular.module("wikitree").factory("Utilities",[function(){var e={};return e.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},e.makeJitter=function(e){var t=e*Math.random();return Math.random()<.5&&(t=-1*t),t},e.shuffleArr=function(e){e=e.slice(0);for(var t,n,o=e.length;o;)n=Math.floor(Math.random()*o--),t=e[o],e[o]=e[n],e[n]=t;return e},e}])}(),function(){angular.module("wikitree.search",["ui.bootstrap.typeahead","ui.bootstrap.tpls"])}(),function(){angular.module("wikitree.search").controller("searchController",["$scope","$location","Search",function(e,t,n){e.inputText="",e.get_suggestions=function(e){return n.get_suggestions(e)},e.tryEnter=function(t){13===t.keyCode&&(t.preventDefault(),e.start_search(!0))},e.start_search=function(n){var o=e.inputText;o&&(e.new_session?t.path(n?"/new/"+o+"/true":"/new/"+o):n?e.session.do_search(o,null,null,!0):e.session.do_search(o)),e.inputText=""}}])}(),function(){angular.module("wikitree.search").directive("search",[function(){return{restrict:"E",templateUrl:"js/angular/search/search.template.html",controller:"searchController",link:function(e,t,n){e.large=n.large,e.new_session=n.newSession}}}])}(),function(){angular.module("wikitree.home",[])}(),function(){angular.module("wikitree.home").controller("home_controller",["$scope","$location","Utilities",function(e,t,n){function o(e,t){this.uuid=n.makeUUID(),this.index=void 0,this.x=e,this.y=t,this.px=void 0,this.py=void 0,this.fixed=void 0,this.weight=void 0}function i(e,t){this.uuid=n.makeUUID(),this.source=e,this.target=t}function r(){if(!(v>f)){if(v++,d.length){var e=Math.floor(Math.random()*d.length),t=d[e],a=new o(t.x+n.makeJitter(10),t.y+n.makeJitter(10)),g=new i(t,a);d.push(a),c.push(g),u[a.uuid]=a,l[t.uuid+","+a.uuid]=g}else d.push(new o(window.innerWidth/2,window.innerHeight/2));s.updateNodesAndLinks(d,c),p=setTimeout(function(){h=window.requestAnimationFrame(r)},200+200*Math.random())}}var a=$("#home-graph"),s=new HomeGraph(a[0]),d=[],c=[],u={},l={},h=null,p=null,f=200,v=0;p=setTimeout(function(){h=window.requestAnimationFrame(r)},600),e.$on("$destroy",function(){clearTimeout(p),window.cancelAnimationFrame(h)})}])}(),function(){angular.module("wikitree.session",["wikitree.session.graph","wikitree.session.menu","wikitree.session.reader","wikitree.session.resizer"])}(),function(){angular.module("wikitree.session").controller("session_controller",["$scope","Search","Sessions","Utilities","init_session",function(e,t,n,o,i){function r(e){this.uuid=e.uuid||o.makeUUID(),this.type=e.type,this.name=e.name,this.title=e.title,this.query=e.query,this.body=e.body,this.index=void 0,this.x=void 0,this.y=void 0,this.px=void 0,this.py=void 0,this.fixed=void 0,this.weight=void 0}function a(e){var t=new r({type:e.type,name:e.name,title:e.title,query:e.query});return m.push(t),k[t.uuid]=t,"note"!==t.type&&(y[t.name]=t),t}function s(e){this.uuid=e.uuid||o.makeUUID(),this.sourceId=e.sourceId,this.targetId=e.targetId,this.linkbackId=e.linkbackId,this.source=k[this.sourceId],this.target=k[this.targetId]}function d(e,t){var n=k[t],i=k[e];t!==e&&(!i.x&&!i.y||n.x||n.y||(n.x=i.x+o.makeJitter(10),n.y=i.y+o.makeJitter(10)),x[e]&&x[e][t]||(x[t]&&x[t][e]?u(e,t,x[t][e].uuid):u(e,t,null)))}function c(e,t){if(!x[e])return null;var n=x[e][t];return n?(w=w.filter(function(e){return e.uuid!==n.uuid}),delete x[e][t],void delete b[n.uuid]):null}function u(e,t,n){var o=new s({sourceId:e,targetId:t,linkbackId:n});w.push(o),x[e]||(x[e]={}),x[e][t]=o,b[o.uuid]=o}function l(){n.save(p,{current_node_id:f,prev_stack:v,next_stack:g,nodes:m,links:w})}var h=this,p=i.uuid,f=i.data.current_node_id,v=i.data.prev_stack,g=i.data.next_stack,m=i.data.nodes,k={},y={},w=i.data.links,b={},x={};setTimeout(function(){e.$apply(function(){e.$broadcast("update:nodes+links"),e.$broadcast("update:currentnode")})},1),e.$on("$destroy",function(){l()}),e.$on("$routeChangeEnd",function(){l()}),$(window).on("beforeunload",function(){l()}),h.get_current_node=function(){return k[f]},h.set_current_node_id=function(t){return f===t?null:(f&&v.push(f),g=[],f=t,void e.$broadcast("update:currentnode"))},h.updateNoteNodeContent=function(t,n,o){var i=k[t];i&&(i.name=n,i.body=o,e.$broadcast("update:note-node-content",i))},h.get_nodes=function(){return m.slice()},h.get_links=function(){return w.slice()},h.getNode=function(e){return k[e]},h.getLink=function(e){return b[e]},h.has_forward=function(){return!!g.length},h.has_backward=function(){return!!v.length},h.go_backward=function(){return v.length?(g.push(f),f=v.pop(),void e.$broadcast("update:currentnode")):null},h.go_forward=function(){
return g.length?(v.push(f),f=g.pop(),void e.$broadcast("update:currentnode")):null},h.removeNode=function(t){var n=k[t];n&&(v=v.filter(function(e){return e!==t}),g=g.filter(function(e){return e!==t}),f===t&&(f=v.length?v.pop():g.length?g.pop():null),m=m.filter(function(e){return e.uuid!==n.uuid}),delete k[n.uuid],"note"!==n.type&&delete y[n.name],w=w.filter(function(e){return e.sourceId!==t&&e.targetId!==t}),delete x[t],Object.keys(x).forEach(function(e){delete x[e][t]}),e.$broadcast("update:nodes+links"),e.$broadcast("update:currentnode"))},h.removeLinkPair=function(t){var n=b[t];if(n){var o=n.source,i=n.target;c(o.uuid,i.uuid),c(i.uuid,o.uuid),e.$broadcast("update:nodes+links")}},h.do_search=function(n,o,i,r){Date.now();if(n&&n.length){var s;s=r?t.findOrAddSearch(n):t.findOrAddArticle(n),s.then(function(t){if(!t)return void alert('Sorry, something went wrong for "'+n+'"');var r=y[t.name]?y[t.name]:a(t);o&&d(o,r.uuid),e.$broadcast("update:nodes+links"),i||(h.set_current_node_id(r.uuid),e.$broadcast("update:currentnode"));Date.now()})["catch"](function(e){})}},h.addNewNoteNode=function(){var t=a({type:"note"});return e.$broadcast("update:nodes+links"),t},h.addLink=function(t,n){d(t,n),e.$broadcast("update:nodes+links")},function(){i["new"]&&(h.do_search(i.term,null,null,i.search),h["new"]=!1),m.forEach(function(e){k[e.uuid]=e,"note"!==e.type&&(y[e.name]=e)}),w.forEach(function(e){var t=e.sourceId,n=e.targetId;e.source=k[t],e.target=k[n],b[e.uuid]=e,x[t]||(x[t]={}),x[t][n]=e})}()}])}(),function(){angular.module("wikitree.session.menu",["wikitree.session.menu.session_tile"])}(),function(){angular.module("wikitree.session.menu").controller("menuController",["$rootScope","$scope","$location","Search","Sessions",function(e,t,n,o,i){t.sessions=i.index,t.active=i.active,t.$watch(function(){return i.active},function(e){t.active=e}),t.open=!1,t.goHome=function(){n.path("/welcome")},t.toggleMenu=function(){t.open=!t.open,e.$broadcast(t.open?"menu:open":"menu:close")},t.sortableOptions={update:function(n,o){t.$broadcast("session:cancel_edit"),e.$broadcast("session:sort",{start:o.item.sortable.index,stop:o.item.sortable.dropindex})}},t.addNoteNode=function(){e.$broadcast("request:graph:add_note_node")},t.locateCurrentNode=function(){e.$broadcast("request:graph:locate_current_node")}}])}(),function(){angular.module("wikitree.session.menu").directive("menu",[function(){return{restrict:"E",replace:!0,templateUrl:"js/angular/session/menu/menu.template.html",controller:"menuController"}}])}(),function(){angular.module("wikitree.session.menu.session_tile",["angularMoment","ui.sortable"])}(),function(){angular.module("wikitree.session.menu.session_tile").directive("enterpress",function(){return{link:function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.enterpress)}),t.preventDefault())})}}})}(),function(){angular.module("wikitree.session.menu.session_tile").directive("escpress",[function(){return{link:function(e,t,n){t.bind("keydown keypress",function(t){27===t.which&&(e.$apply(function(){e.$eval(n.escpress)}),t.preventDefault())})}}}])}(),function(){angular.module("wikitree.session.menu.session_tile").directive("focus",["$timeout",function(e){return{scope:{trigger:"@focus"},link:function(t,n){t.$watch("trigger",function(t){"true"===t&&e(function(){n[0].focus()})})}}}])}(),function(){angular.module("wikitree.session.menu.session_tile").controller("sessionController",["$scope","$location","Sessions",function(e,t,n){e.editing=!1,e.edit=function(){e.editing||e.$parent.$broadcast("session:cancel_edit"),e.editing=!e.editing,e.$parent.$broadcast("focus")},e.cancel_edit=function(){e.$parent.$broadcast("session:cancel_edit")},e.$on("session:cancel_edit",function(){e.session.rename=e.session.name,e.editing=!1}),e.select=function(n){e.$parent.$broadcast("session:cancel_edit"),t.path("/session/"+e.session.uuid)},e["delete"]=function(t){n["delete"](t),e.$parent.$broadcast("session:cancel_edit")},e.rename=function(){e.session.name=e.session.rename,e.session.rename=e.session.name,e.editing=!1}}])}(),function(){angular.module("wikitree.session.menu.session_tile").directive("session",[function(){return{restrict:"E",replace:!0,templateUrl:"js/angular/session/menu/session_tile/session_tile.template.html",controller:"sessionController"}}])}(),function(){angular.module("wikitree.session.reader",[])}(),function(){angular.module("wikitree.session.reader").controller("readerController",["$rootScope","$scope","Resizer","Loading","Sessions","Articles","Searches","Categories",function(e,t,n,o,i,r,a,s){function d(e,n){s.getByTitle(e.title).then(function(o){t.frameWindow.loadCategory(o,l(e)),n&&n(o)})["catch"](function(){t.frameWindow.loadError('System error: unable to load "'+e.title+'"')})}function c(e,n){r.getByTitle(e.title).then(function(o){t.frameWindow.loadArticle(o,l(e)),n&&n(o)})["catch"](function(){t.frameWindow.loadError('System error: unable to load article "'+e.title+'"')})}function u(e,n){a.getByQuery(e.query).then(function(o){t.frameWindow.loadSearch(o,l(e)),n&&n(o)})["catch"](function(){t.frameWindow.loadError('System error: unable to load search "'+e.query+'"')})}function l(e){return function(n,o,i){t.$apply(function(){n=decodeURIComponent(n),t.session.do_search(n,e.uuid,o,i)})}}t.readerWidth=n.size+"px",t.currentNodeName=null,t.missedFrameUpdate=!1,t.hasReferences=!1,t.loadingCount=o.count,t.hasBackward=t.session.has_backward(),t.hasForward=t.session.has_forward(),t.$on("update:currentnode",function(){t.hasBackward=t.session.has_backward(),t.hasForward=t.session.has_forward()}),t.$on("mediawikiapi:loadstart",function(){t.loadingCount=o.count}),t.$on("mediawikiapi:loadend",function(){t.loadingCount=o.count}),t.$on("update:currentnode",function(){t.updateFrameNode()}),t.$on("split:resize",function(e,o){t.readerWidth=n.size+"px"}),t.historyBackward=function(){t.session.go_backward()},t.historyForward=function(){t.session.go_forward()},t.openSourceArticle=function(){var e=t.session.get_current_node();if(e&&e.name){var n="";switch(e.type){case"article":n="https://en.wikipedia.org/wiki/",n+=encodeURIComponent(e.title);break;case"search":n="http://en.wikipedia.org/w/index.php?fulltext=1&search=",n+=encodeURIComponent(e.query)}var o=document.createElement("a");o.target="_blank",o.href=n,o.click()}},t.scrollToReferences=function(){t.frameWindow&&t.frameWindow.scrollToReferences()},t.updateFrameNode=function(){function e(){t.hasReferences=t.frameWindow.checkForReferences()}if(!t.frameWindow)return void(t.missedFrameUpdate=!0);var n=t.session.get_current_node();if(n&&(!t.currentNodeName||t.currentNodeName!==n.name))switch(t.currentNodeName=n.name,n.type){case"category":d(n,e);break;case"article":c(n,e);break;case"search":u(n,e)}},t.session.get_current_node()&&t.updateFrameNode()}])}(),function(){angular.module("wikitree.session.reader").directive("reader",[function(){return{restrict:"E",replace:!0,templateUrl:"js/angular/session/reader/reader.template.html",controller:"readerController",link:function(e,t,n){e.frameWindow=null,t.find("iframe").on("load",function(){e.frameWindow=this.contentWindow,e.missedFrameUpdate&&e.updateFrameNode()}).attr("src","article-frame.html")}}}])}(),function(){angular.module("wikitree.session.graph",[])}(),function(){angular.module("wikitree.session.graph").controller("graphController",["$scope","Resizer",function(e,t){e.positionRight=t.size+"px",e.$on("request:graph:locate_current_node",function(){var t=e.session.get_current_node();e.graph.centerOnNode(t)}),e.$on("request:graph:locate_node",function(t,n){e.graph.centerOnNode(n)}),e.$on("request:graph:add_note_node",function(){e.session.addNewNoteNode()}),e.$on("split:resize",function(n,o){e.positionRight=t.size+"px",setTimeout(function(){e.graph.updateSize()},1)}),e.$on("update:nodes+links",function(){var t=e.session.get_nodes(),n=e.session.get_links();e.graph.updateNodesAndLinks(t,n)}),e.$on("update:currentnode",function(){var t=e.session.get_current_node();e.graph.updateCurrentNode(t)}),e.$on("update:note-node-content",function(t,n){e.graph.updateNoteNodeContent(n)}),e.setCurrentNode=function(t){e.session.set_current_node_id(t)},e.setCurrentNoteNode=function(t){e.session.setCurrentNoteNodeId(t)},e.removeNode=function(t){var n=e.session.getNode(t);n&&window.confirm('Remove the node "'+n.name+'" from your session?')&&e.session.removeNode(n.uuid)},e.removeLink=function(t){var n=e.session.getLink(t);if(n){var o=n.source,i=n.target;window.confirm('Remove the link between "'+o.name+'" and "'+i.name+'" from your session?')&&e.session.removeLinkPair(n.uuid)}},e.addLink=function(t,n){e.session.addLink(t,n)}}])}(),function(){angular.module("wikitree.session.graph").directive("graph",[function(){return{restrict:"E",replace:!0,templateUrl:"js/angular/session/graph/graph.template.html",controller:"graphController",link:function(e,t){e.graph=new ForceGraph(t[0],e),e.$broadcast("update:nodes+links"),e.$broadcast("update:currentnode")}}}])}(),function(){angular.module("wikitree.session.resizer",[])}(),function(){angular.module("wikitree.session.resizer").directive("resizer",["$rootScope","Resizer",function(e,t){var n=function(n,o,i){function r(n){var o=window.innerWidth;o-n<t.MIN_REMAINDER||n<t.MIN_SIZE||(t.size=n,t.ratio=n/o,e.$broadcast("split:resize"))}function a(){u.css({width:"100%",left:0,right:0})}function s(){u.css({width:"",left:"",right:t.size-l+5})}function d(e){e.preventDefault(),n.$apply(function(){r(window.innerWidth-e.pageX)})}var c=$(window),u=$("#resizer"),l=u.width();r(t.ratio*window.innerWidth),s(),u.on("mousedown",function(e){n.$apply(function(){a()}),c.on("mousemove",d),c.one("mouseup",function(e){n.$apply(function(){s()}),c.unbind("mousemove",d)})}),c.on("resize",function(){n.$apply(function(){r(t.ratio*window.innerWidth),s()})})};return{restrict:"E",replace:!0,templateUrl:"js/angular/session/resizer/resizer.template.html",link:n}}])}(),function(){angular.module("wikitree").factory("Resizer",[function(){var e={};return e.MIN_REMAINDER=120,e.MIN_SIZE=300,e.ratio=.6,e.size=e.ratio*window.innerWidth,e}])}(),function(){angular.module("wikitree").factory("Articles",["$q","$http","$rootScope",function(e,t,n){function o(e){this.title=e.title,this.content=e.content,this.categories=e.categories}function i(o){var i=Date.now();return e(function(e,r){n.$broadcast("mediawikiapi:loadstart",i),t.jsonp("https://en.wikipedia.org/w/api.php",{params:{action:"parse",prop:"text|categorieshtml|displaytitle",redirects:"true",page:o,format:"json",callback:"JSON_CALLBACK"}}).success(function(t){n.$broadcast("mediawikiapi:loadend",i),t&&t.parse&&t.parse.title?e(t.parse):(console.error("Article API error",arguments),r(null))}).error(function(){n.$broadcast("mediawikiapi:loadend",i),console.error("Article API error",arguments),r(null)})})}var r={},a={},s={};return s.getByTitle=function(t){return e(function(e,n){r[t]?e(r[t]):i(t).then(function(i){if(i){var a=new o({title:i.title,content:i.text["*"],categories:i.categorieshtml["*"],displaytitle:i.displaytitle});r[a.title]=a,e(a)}else console.error("Article not found",t),n(null)})["catch"](function(){console.error("Article API error",t,arguments),n(null)})})},s.getByUnsafeTitle=function(t){return e(function(e,n){a[t]?e(a[t]):i(t).then(function(i){if(i){var s=new o({title:i.title,content:i.text["*"],categories:i.categorieshtml["*"],displaytitle:i.displaytitle});a[t]=s,r[s.title]=s,e(s)}else console.error("Article not found!",t),n(null)})["catch"](function(){console.error("Article API error",t,arguments),n(null)})})},s}])}(),function(){angular.module("wikitree").factory("Categories",["$q","$http","$rootScope",function(e,t,n){function o(e){this.name=e.name,this.title=e.title,this.content=e.content,this.categories=e.categories,this.displaytitle=e.displaytitle,this.subcategories=e.subcategories,this.memberpages=e.memberpages}function i(o){var i=Date.now();return e(function(r,a){var s=t.jsonp("https://en.wikipedia.org/w/api.php",{params:{action:"parse",prop:"text|categorieshtml|displaytitle",redirects:"true",page:o,format:"json",callback:"JSON_CALLBACK"}}),d=t.jsonp("https://en.wikipedia.org/w/api.php",{params:{action:"query",list:"categorymembers",cmtype:"subcat",cmtitle:o,cmlimit:500,format:"json",callback:"JSON_CALLBACK"}}),c=t.jsonp("https://en.wikipedia.org/w/api.php",{params:{action:"query",list:"categorymembers",cmtype:"page",cmtitle:o,cmlimit:500,format:"json",callback:"JSON_CALLBACK"}});e.all([s,d,c]).then(function(e){n.$broadcast("mediawikiapi:loadend",i);var t=e[0],o=e[1],s=e[2],d={};t&&t.data&&t.data.parse&&t.data.parse.title&&(d.title=t.data.parse.title,d.content=t.data.parse.text["*"],d.categories=t.data.parse.categorieshtml["*"],d.displaytitle=t.data.parse.displaytitle),o&&o.data&&o.data.query&&o.data.query.categorymembers&&o.data.query.categorymembers.length&&(d.subcategories=o.data.query.categorymembers),s&&s.data&&s.data.query&&s.data.query.categorymembers&&s.data.query.categorymembers.length&&(d.memberpages=s.data.query.categorymembers),d.title?(d.name=d.title.slice("Category:".length),r(d)):(console.error("Category API error",arguments),a(null))})["catch"](function(){n.$broadcast("mediawikiapi:loadend",i),console.error("Category API error",arguments),a(null)})})}var r={},a={},s={};return s.getByTitle=function(t){return e(function(e,n){r[t]?e(r[t]):i(t).then(function(i){if(i){var a=new o({name:i.name,title:i.title,content:i.content,categories:i.categories,displaytitle:i.displaytitle,subcategories:i.subcategories,memberpages:i.memberpages});r[a.title]=a,e(a)}else console.error("Category not found",t),n(null)})["catch"](function(){console.error("Category API error",t,arguments),n(null)})})},s.getByUnsafeTitle=function(t){return e(function(e,n){a[t]?e(a[t]):i(t).then(function(i){if(i){var s=new o({name:i.name,title:i.title,content:i.content,categories:i.categories,displaytitle:i.displaytitle,subcategories:i.subcategories,memberpages:i.memberpages});a[t]=s,r[s.title]=s,e(s)}else console.error("Category not found!",t),n(null)})["catch"](function(){console.error("Category API error",t,arguments),n(null)})})},s}])}(),function(){angular.module("wikitree").factory("Loading",["$rootScope",function(e){var t={};return t.count=0,e.$on("mediawikiapi:loadstart",function(){t.count++}),e.$on("mediawikiapi:loadend",function(){t.count--,t.count<0&&(t.count=0)}),t}])}(),function(){angular.module("wikitree").factory("Searches",["$q","$http","$rootScope",function(e,t,n){function o(e){this.query=e.query,this.suggestion=e.suggestion,this.totalhits=e.totalhits,this.results=e.results}function i(o){var i=Date.now();return e(function(e,r){n.$broadcast("mediawikiapi:loadstart",i),t.jsonp("https://en.wikipedia.org/w/api.php",{params:{action:"query",list:"search",srprop:"titlesnippet|snippet|size|wordcount|timestamp",srsearch:o,srlimit:50,format:"json",callback:"JSON_CALLBACK"}}).success(function(t){n.$broadcast("mediawikiapi:loadend",i),t&&t.query&&t.query.searchinfo?e(t.query):(console.error("Search API error",arguments),r(null))}).error(function(){n.$broadcast("mediawikiapi:loadend",i),console.error("Search API error",arguments),r(null)})})}var r={},a={};return a.getByQuery=function(t){return e(function(e,n){r[t]?e(r[t]):i(t).then(function(i){if(i){var a=new o({query:t,suggestion:{text:i.searchinfo.suggestion,html:i.searchinfo.suggestionsnippet},totalhits:i.totalhits,results:i.search});r[a.query]=a,e(a)}else console.error("Search failed",t),n(null)})["catch"](function(){console.error("Search API error",t,arguments),n(null)})})},a}])}();